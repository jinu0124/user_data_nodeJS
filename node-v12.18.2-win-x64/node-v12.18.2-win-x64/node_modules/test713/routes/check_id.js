const express = require('express'); // nodejs express 사용
const app = express();
const router = express.Router();

var mariadb_con = require('../routes/mariadb_conn.js')();

// ID check .JS (register_form)
exports.post = function(req, res){
	var data = req.body; // req.body.id 와 같이 id로 받을 수도 있다. 
	// req.body는 {id: "user_id"} 와 같이 받는다.
		
	var connection = mariadb_con.init();
	mariadb_con.test_open(connection);
	
	var duplicate = 0;
	var dupl_data = new Object(); // JSON 형태로 Data를 묶어서 하나의 매개변수로 res.send()하기 위함.
	
	var sql = "select id from client where id like " + data.id + ";"; // 중복 ID DB 조회
	
	if (data.id == ""){
		duplicate = 2;
		dupl_data.dupl = duplicate;
		console.log(dupl_data);
		res.send(dupl_data);
	}
	else{
		connection.query(sql, function (error, rows, fields){
			try{
				if(!error){
					if(rows.length == 1){
						duplicate = 1; // DB에 중복된 ID가 존재할 때
					}
				}
				else{
					console.log("DB SQL 구문 에러.");
				}
			}
			catch(e)
			{
				console.log("DB or Syntax 에러.");
			}
			finally{
				dupl_data.id = data.id;
				dupl_data.dupl = duplicate;
				res.send(dupl_data);
			}
		});
	}
};

