const express = require('express'); // nodejs express 사용
const app = express();
const router = express.Router();

var mariadb_con = require('../routes/mariadb_conn.js')();

//req : 응답, res : 보내는 결과
// 사용자에게 등록된 차량 출력 페이지 렌더링
exports.post = function(req, res){ 	
	res.render('user_info');		
};
 
exports.get = function(req, res){
	var connection = mariadb_con.init();

	mariadb_con.test_open(connection);
	
	client_id = info_dict['client_id'];
	console.log("client_id : " + client_id);
	// 현재 사용자에게 등록된 차량 정보 조회 sql
	sql = "select * from car where car_id = (select car_id from car_client where client_id = " + client_id + ");";
	
	var car_dict = new Array(new Object());
	car_dict[0].number = 0;
	
	connection.query(sql, function(error, rows, fields){
		try{
			if(!error){
				for(var i=0; i<rows.length; i++){
					car_dict[i].car_id = rows[i]['car_id'];
					car_dict[i].name = rows[i]['name'];
					car_dict[i].type = rows[i]['type'];
					car_dict[i].price = rows[i]['price'];
					car_dict[i].launch_year = rows[i]['launch_year'];
					car_dict[0].number += 1;
				}
				console.log(car_dict[0]);
				res.render('enrolled_car_info', {car_info: car_dict});
			}
		}
		catch(e){
			console.log("try 문 안 에러.");
		}
	})
	
};

