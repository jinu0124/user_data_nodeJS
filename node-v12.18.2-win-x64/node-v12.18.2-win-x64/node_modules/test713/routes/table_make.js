const express = require('express'); // nodejs express 사용
const app = express();
const router = express.Router();

var mariadb_con = require('../routes/mariadb_conn.js')();

// Table Create init 하는 곳

//req : 응답, res : 보내는 결과
exports.get = function(req, res){ 		
	var connection = mariadb_con.init();

	mariadb_con.test_open(connection);
	
	console.log("DB Connection Succeed, Make init Table.");
	
	var make_client = "CREATE TABLE if not exists client"
		+"(client_id int(11) not null primary key AUTO_INCREMENT,"
		+"id varchar(20) unique not null,"
		+"pw blob,"
		+"level varchar(10) not null,"
		+"age int not null,"
		+"register_date varchar(20) not null,"
		+"name varchar(20) not null,"
		+"gender varchar(10) not null,"
		+"delete_flag boolean,"
		+"check(level in('bronze', 'silver', 'gold', 'platinum')),"
		+"check(gender in('men', 'women')),"
		+"phone_num varchar(11) not null," +
		"train_flag TINYINT not null)ENGINE=innoDB DEFAULT CHARSET=utf8;";
	
	var car = "create table if not exists car" +
			"(car_id int primary key AUTO_INCREMENT," +
			"name varchar(20) not null," +
			"type varchar(20) not null," +
			"price int check(price>0)," +
			"launch_year int)ENGINE=innoDB DEFAULT CHARSET=utf8;";
	
	var using = "create table if not exists car_client" +
			"(serial_number int primary key AUTO_INCREMENT," +
			"car_id int," +
			"client_id int," +
			"foreign key (car_id) references car(car_id) on delete cascade on update cascade," +
			"foreign key (client_id) references client(client_id) on delete cascade on update cascade)ENGINE=innoDB DEFAULT CHARSET=utf8;";
	
	var car_setting = "Create Table if not exists car_setting" +
			"(car_id int," +
			"client_id int," +
			"seat_x int," +
			"seat_y int," +
			"seat_z int," +
			"temperature int," +
			"left_mirror_x int," +
			"left_mirror_y int," +
			"right_mirror_x int," +
			"right_mirror_y int," +
			"primary key(car_id, client_id)," +
			"foreign key (car_id) references car(car_id) on delete cascade on update cascade," +
			"foreign key (client_id) references client(client_id) on delete cascade on update cascade)ENGINE=innoDB DEFAULT CHARSET=utf8;";
	
	connection.query(make_client, function (error, rows, fields){
		if(!error){
			console.log('make client table done.');
		}
		else{
			console.log('SQL ERROR');
		}
	})
	
	connection.query(car, function (error, rows, fields){
		if(!error){
			console.log('make car table done.');
		}
		else{
			console.log('SQL ERROR');
		}
	})
	
	connection.query(using, function (error, rows, fields){
		if(!error){
			console.log('make using table done.');
		}
		else{
			console.log('SQL ERROR');
		}
	})
	
	connection.query(car_setting, function (error, rows, fields){
		if(!error){
			console.log('make car_setting table done.');
		}
		else{
			console.log('SQL ERROR');
		}
	})
//	var url = "http://localhost:3030/";
//    window.location.href = url;

};
