<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <title>Connected Car Service</title>
    <link rel="stylesheet" href="css/register_form.css">

    <script language="javascript">
    
    var confirm_1 = false; // ID confirm
    var confirm_2 = false; // PW confirm

      function id_check_func(){
          var input_id = document.querySelector('input[name="id"]'); // input 태그의 name="id"인 값을 가져온다.
          // var formData = $("#form1").serialize();

          // getTextLength() 문자열 받아서 문자열의 길이를 반환하는 함수
          function getTextLength(str){
            var len = 0;
            for (var i = 0; i < str.length; i++) {
              if (escape(str.charAt(i)).length == 6) {
                  len++;
              }
              len++;
            }
            return len;
          }

          //ID 중복 체크 후 값을 변경했을 때
          $('.id_input_form').change(function(){ // <input class>가 id_input_form인 값이 변경되면 수행
            $('#id_check_success').hide(); // id="id_check_success"태그가 있는 이미지 숨기기
            $('.id_overlap_check').show(); // id : #, class : .
            $('#inform').show();
            $('.id_input_form').attr("check_result", "fail"); // attr : 태그의 속성을 변경할 때 사용
            $('#submit_button').attr("disabled", true);
          })

          $('.pass_phrase').change(function(){
            console.log(getTextLength($('.pass_phrase').val()));
            var length_pw = getTextLength($('.pass_phrase').val());
            if(length_pw < 8 || length_pw > 16){
              console.log("8~16글자 사이의 비밀번호를 입력해주세요.");
              $('#inform_pw').show();
              $('#submit_button').attr("disabled", true);
              confirm_2 = false;
            }
            else if(length_pw >= 8 && length_pw <= 16){
              $('#inform_pw').hide();
              confirm_2 = true;
              console.log(confirm_1, confirm_2);
              if(confirm_2 == true){
                $('#submit_button').attr("disabled", false);
              }
            }
          })

          // $('.id_input_form').attr("check_result") == fail

          //AJAX 구문 data 보내고 처리 후 success에서 받기
          $.ajax({
            type: "post",
            url: "/check_id",
            datatype: "json",
            data: {
              "id": input_id.value
            },

            success: function(dupl_data){
              // console.log(data.id);
              // console.log(data);
              //console.log(dupl);
              if (dupl_data){
                console.log(dupl_data["dupl"]);
                if (dupl_data["dupl"] == 1){
                  alert("이미 중복된 ID가 존재합니다.");
                  var confirm_1 = false;
                  $('#submit_button').attr("disabled", true);
                }
                else if(dupl_data["dupl"] == 2){
                  alert("ID를 적은 후 ID 중복확인을 클릭해주세요.");
                  var confirm_1 = false;
                  $('#submit_button').attr("disabled", true);
                }
                else{
                  alert("사용가능한 ID 입니다.");
                  $('.id_overlap_check').hide();
                  $('#inform').hide();
                  $('#id_check_success').show();
                  $('.id_input_form').attr("check_result", "success");
                  confirm_1 = true;
                  console.log(confirm_1, confirm_2);
                  if(confirm_1 == true && confirm_2 == true){
                    $('#submit_button').attr("disabled", false);
                  }
                }
              }
              else{
                console.log("AJAX 불러오기 실패");
              }
            }
          })
      };
  </script>
  </head>

  <body>
    <div class="container">
      <div class="fill_out_the_form">
        FILL OUT THIS REGISTRATION FORM
      </div>

      <form action="register_check" method="post">
        <div class="inner_form">
          <div class="id">
            &nbsp;NAME (영어로 입력 부탁드립니다. Ex) Kwonjinwoo)
          </div><br>
          <div class="input_absolute">
            <input type="text" name="name" maxlength="20" style="width: 200px; height:28px;" required>
          </div>
        </div>

        <div class="inner_form">
          <div class="id">
            &nbsp;ID
          </div>  
          <br>
          <div class="input">
            <input type="text" class="id_input_form" name="id" maxlength="20"  style="width: 200px; height: 30px;" check_result="fail" required>
            <button type="button" class="id_overlap_check" onclick="id_check_func()">ID 중복 확인</button> 
            <img class="circle" src="./css/ok.png" id="id_check_success" style="display: none;">
          </div><h5 id="inform">&nbsp;ID 중복 확인을 체크해주세요.</h5>
        </div>

        <div class="inner_form">
          <div class="id">
            &nbsp;Pass Phrase
          </div><br>
          <div class="input">
            <input class="pass_phrase" type="password" name="pw" style="width: 200px; height: 30px;" required>
          </div><h5 id="inform_pw">&nbsp;8~16 글자 사이의 비밀번호를 입력해주세요</h5>
        </div>

        <div class="inner_form">
          <div class="id">
            &nbsp;AGE
          </div><br>
          <div class="input">
            &nbsp;<select name="age_year" type="number">
              <option>1960</option><option>1961</option><option>1962</option><option>1963</option><option>1964</option><option>1965</option><option>1966</option><option>1967</option><option>1968</option>
              <option>1969</option><option>1970</option><option>1971</option><option>1972</option><option>1973</option><option>1974</option><option>1975</option><option>1976</option><option>1977</option>
              <option>1978</option><option>1979</option><option>1980</option><option>1981</option><option>1982</option><option>1983</option><option>1984</option><option>1985</option><option>1986</option>
              <option>1987</option><option>1988</option><option>1989</option><option>1990</option><option>1991</option><option>1992</option><option>1993</option><option>1994</option><option>1995</option>
              <option>1996</option><option>1997</option><option>1998</option><option>1999</option><option>2000</option><option>2001</option>
            </select>
            <select name="age_month" type="number">
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
              <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
              <option>11</option><option>12</option>
            </select>
            <select name="age_day" type="number">
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
              <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
              <option>11</option><option>12</option><option>13</option><option>14</option><option>15</option>
              <option>16</option><option>17</option><option>18</option><option>19</option><option>20</option>
              <option>21</option><option>22</option><option>23</option><option>24</option><option>25</option>
              <option>26</option><option>27</option><option>28</option><option>29</option><option>30</option><option>31</option>
            </select>
          </div>
        </div>

        <div class="inner_form">
          <div class="id">
            &nbsp;GENDER
          </div><br>
          <div class="input">
            &nbsp;<select name="gender" type="text">
              <option>
                Women
              </option>
              <option>
                Men
              </option>
            </select>
          </div>
        </div>

        <div class="inner_form">
          <div class="id">
            &nbsp;TEL. NUMBER 
          </div><br>
          <div class="input">
            <input type="text" name="phone_num" maxlength="11" style="width: 200px; height: 30px;" required>
          </div>
         
          <h5 id="inform">&nbsp;예시 : 01012345678  양식과 같이 작성해주세요.</h5>
        </div>

        <input id="submit_button" type="submit" value="가입하기" disabled='disabled';>
      </form>
     
    </div>
    <h1><br><br><br></h1>
  </body>
</html>